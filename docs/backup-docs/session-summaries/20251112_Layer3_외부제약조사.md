# Layer 3 외부 제약 조사 결과 - 주식 거래 플랫폼

**날짜**: 2025-11-12
**작성자**: 2호 (Claude Code)
**목적**: Phase 2 주식 거래 플랫폼 Layer 3 분석 - 외부 제약 조사

---

## 🎯 조사 범위

주식 거래 플랫폼 구축 시 **외부에서 부과되는 제약사항**:
1. 증권사 API 기술 제약
2. 금융 규제 (법률)
3. 개인정보보호 및 보안 요구사항

---

## 📊 조사 결과 요약

### 증권사별 API 호출 제한 비교

| 증권사 | REST API | 초당 제한 | 시간당 제한 | API 방식 | 비고 |
|------|----------|----------|------------|---------|------|
| **한국투자증권** | ✅ | 20건 (실전), 2건 (모의) | - | REST + WebSocket | 최초 REST API 제공 (2022) |
| **키움증권** | ❌ | 5건 | 1000건 | COM/DLL (Windows) | 레퍼런스 가장 많음 |
| **이베스트투자증권** | ✅ | 10건 (모의) | - | REST + WebSocket | 수수료 저렴, 최근 REST 출시 |
| **대신증권** | ❌ | - | - | COM/DLL (Windows) | 전산 강자, 보안 이슈 |
| **NH투자증권** | ⚠️ | ? | ? | QV API | 정보 제한적 |
| **삼성증권** | ❌ | - | - | 기관/VVIP만 | 개인 사용 불가 |

### 공통 제약사항

| 항목 | 제약 수준 | 아키텍처 영향 | 비고 |
|------|----------|-------------|------|
| API 호출 제한 | 🔴 높음 | 설계 필수 고려 | 증권사마다 다름 (5~20건/초) |
| WebSocket 제한 | 🟡 중간 | 실시간 기능 제한 | 한투: 41건 |
| 데이터 보관 의무 | 🔴 높음 | 저장소 설계 필수 | 10년+ 보관 |
| 보안 인증 | 🟡 중간 | 인증 시스템 설계 | 토큰 또는 공인인증서 |
| 개인정보 처리 | 🔴 높음 | 암호화, 로깅 필수 | 접근 로그 1년 |
| OS 제약 | 🟡 중간 | 개발 환경 제한 | 키움/대신: Windows 필수 |

---

## 1️⃣ 증권사 API 제약 상세 비교

### A. 한국투자증권 Open API ⭐ (추천)

**장점**:
```
✅ REST API 제공 (국내 최초, 2022.04)
✅ 크로스 플랫폼 (Windows, Linux, macOS)
✅ ChatGPT, Claude 연동 샘플 제공
✅ 초당 20건 (증권사 중 가장 높음)
✅ API 사용료 무료
```

**단점**:
```
❌ 레퍼런스 상대적으로 적음 (2022년 출시)
```

#### REST API 호출 제한

**Rate Limiting**:
```
실전 투자 (Production):
- 초당 20건 (계좌 단위)
- 슬라이딩 윈도우 방식
- 접근토큰발급: 초당 1건

모의 투자 (Sandbox):
- 초당 2건 (실전의 1/10)
- 테스트 환경 제공
```

**아키텍처 영향**:
```
✅ 필수 구현:
1. 요청 큐잉 시스템
   - Redis Queue 또는 In-Memory Queue
   - 우선순위 처리 (거래 > 조회)

2. Throttling (쓰로틀링)
   - 초당 요청 수 제어
   - 경계점 요청 분산

3. 에러 처리
   - Rate Limit 초과 시 재시도
   - 백오프 전략

❌ 불가능:
- 실시간 틱 단위 모니터링 (초당 수백 건)
- 무제한 병렬 처리
```

### B. WebSocket 실시간 데이터

**제한 사항**:
```
1세션당 제한:
- 실시간 데이터 합산 41건
  - 실시간 체결가
  - 호가
  - 예상체결
  - 체결통보

- 국내/해외 주식, 파생 모두 포함
- 1계좌(앱키) = 1세션
```

**아키텍처 영향**:
```
✅ 설계 고려:
1. 관심 종목 제한
   - 최대 41개 종목 동시 모니터링
   - 우선순위 종목 선택 로직

2. 구독 관리
   - 동적 구독/해제
   - 사용자별 구독 최적화

3. 데이터 공유
   - 여러 사용자가 동일 종목 구독 시
   - WebSocket 1개로 공유

❌ 제약:
- 대량 종목 동시 모니터링 불가
- 모든 사용자에게 개별 WebSocket 불가
```

### C. 인증 방식

**방식**:
```
토큰 기반 인증:
1. Appkey + App secret → 접근토큰 발급
2. 토큰으로 API 호출
3. 토큰 만료 시 갱신

WebSocket:
1. 접속키 발급
2. WebSocket 연결
3. 실시간 데이터 수신
```

**아키텍처 영향**:
```
✅ 필수 구현:
1. 토큰 관리
   - 자동 갱신
   - 만료 처리

2. 키 보안
   - 환경 변수 저장
   - 암호화 저장

3. 세션 관리
   - WebSocket 재연결
   - 연결 상태 모니터링
```

### D. 비용

**수수료**:
```
✅ 무료:
- API 사용료 없음
- 매매수수료 = HTS 수수료와 동일

주의:
- 실제 매매 수수료는 별도
- 과도한 API 호출 시 제한 가능
```

---

### B. 키움증권 Open API+

**장점**:
```
✅ 레퍼런스 가장 많음 (오래된 API)
✅ 보안성 우수 (인증서 기반, 코드 노출 없음)
✅ API 사용료 무료
```

**단점**:
```
❌ Windows 전용 (COM/DLL)
❌ 초당 5건 (제한적)
❌ 시간당 1000건 제한
❌ 조건검색: 1분당 1회
```

**Rate Limiting**:
```
- 초당: 5회
- 시간당: 1000회
- 조건검색: 1분당 1회
```

**아키텍처 영향**:
```
⚠️ 제약:
- Windows 서버 필수
- Linux/Docker 배포 불가
- 한투 대비 4배 느림 (5건 vs 20건)
```

---

### C. 이베스트투자증권 Xing API

**장점**:
```
✅ REST API 제공 (최근 출시)
✅ 크로스 플랫폼
✅ 수수료 저렴
```

**단점**:
```
❌ 모의서버: 초당 10건 (실전 정보 부족)
❌ 레퍼런스 적음
```

**Rate Limiting**:
```
모의서버:
- 초당: 10건

실전:
- 정보 제한적 (추가 조사 필요)
```

---

### D. 대신증권 CYBOS PLUS API

**장점**:
```
✅ 전산 강자 (전통적 강점)
```

**단점**:
```
❌ Windows 전용 (COM/DLL)
❌ 보안 이슈 (자동로그인 시 인증 정보 노출)
❌ Rate Limit 정보 부족
```

**아키텍처 영향**:
```
⚠️ 보안 위험:
- 자동로그인 구현 시 인증서 비밀번호 노출 가능
```

---

### E. NH투자증권 QV API

**상태**:
```
⚠️ 정보 제한적
- QV Open API 제공
- Rate Limit 정보 없음
- 추가 조사 필요 (고객센터 문의)
```

---

### F. 삼성증권 API

**상태**:
```
❌ 개인 개발자 사용 불가
- 기관투자자 전용 (유료)
- VVIP 고객 (100억+ 자산) 제공
```

---

### 🎯 증권사 선택 기준

**개인 프로젝트 추천 순위**:
```
1위: 한국투자증권
   - REST API, 크로스 플랫폼
   - 초당 20건 (가장 빠름)
   - 현대적 개발 환경

2위: 이베스트투자증권
   - REST API, 수수료 저렴
   - 초당 10건 (모의)
   - 실전 정보 확인 필요

3위: 키움증권
   - 레퍼런스 많음
   - Windows 전용, 초당 5건
   - 기존 프로젝트 참고 용이

❌ 비추천:
- 대신증권: 보안 이슈
- NH투자증권: 정보 부족
- 삼성증권: 개인 사용 불가
```

---

## 2️⃣ 개인 개발자의 법적 의무 (개인 사용 기준)

### ⚠️ 중요: 증권회사 vs 개인 개발자 구분

**증권회사가 지켜야 하는 것 (우리와 무관)**:
```
❌ 개인 개발자가 안 지켜도 됨:
- KYC (투자자 정보 수집) → 증권사가 함
- 거래 기록 10년 보관 → 증권사가 함
- 금융위원회 신고 → 증권사가 함
- 투자자 개인정보 관리 → 증권사가 함
- 적합성 원칙 준수 → 증권사가 함

이유:
→ 증권사 API 사용 = 증권사 시스템 통해 거래
→ 규제 준수는 증권사 책임
```

**개인 개발자가 지켜야 하는 것 (우리)**:
```
✅ 필수 준수:
1. 증권사 API 약관 준수
   - 계약 조건 준수
   - API 사용 제한 준수

2. 본인 계좌만 사용
   - 타인 계좌 거래 금지
   - 계좌 공유 금지

3. API 보안
   - API 키/토큰 안전 관리
   - 노출 방지 (GitHub 등)

4. 통신 보안
   - HTTPS 사용 (증권사 API 기본 제공)
   - 중간자 공격 방지
```

### A. 알고리즘 트레이딩 규제

**개인 사용자 규제 현황 (2024-2025)**:
```
✅ 규제 없음:
- 동시 5억원 미만 거래: 규제 대상 아님
- 기관 프로그램 매매와 구분
- 한국거래소 특별 규제 없음

⚠️ 단, 다음 경우 규제 발생:
- 타인 자금 운용 → 금융투자업 인가 필요
- 서비스 제공 (유/무료) → 금융당국 인허가 필요
- 내부자 거래 → 불법
```

**아키텍처 영향**:
```
✅ 개인 사용만:
- 대부분 규제 면제
- 자유로운 기술 선택
- 신고/인허가 불필요

❌ 서비스화 시:
- 금융당국 인허가
- 사용자 개인정보 보호
- 거래 기록 관리
→ 완전히 다른 차원의 규제!
```

### B. UI/UX 규제 (참고)

**증권사 플랫폼 규제** (증권사가 지킴):
```
주문입력창 요구사항:
- 단가입력란에 "원" 표시
- 단가/수량 입력란 색상 차별화
- 주문 실수 방지 UI

⚠️ 개인 프로그램:
- 본인만 사용 → 규제 미적용
- 단, 실수 방지 UI는 권장
```

**아키텍처 영향**:
```
✅ 선택사항 (권장):
- 주문 확인 절차
- 오입력 방지 UI
- 거래 로그 (본인 확인용)

이유:
→ 법적 의무는 아니지만
→ 실수로 인한 손실 방지
```

### C. 개인정보보호법

**개인 사용 프로그램**:
```
✅ 본인 정보만:
- 개인정보보호법 미적용
- 본인 계좌, 본인 정보만 처리

❌ 타인 정보 처리 시:
- 개인정보보호법 준수 필요
- 동의, 암호화, 보관 의무
```

**아키텍처 영향**:
```
✅ 개인 사용:
- 데이터 보관 의무 없음
- 암호화 선택사항 (권장)
- 접근 로그 선택사항

⚠️ API 키 보안만 필수:
- 환경 변수 저장
- GitHub 노출 방지
- .gitignore 설정
```

### D. 보안 모범 사례 (법적 의무 아님)

**권장 사항**:
```
✅ 권장:
1. API 키 보안
   - 환경 변수 또는 별도 파일
   - Git 저장소 제외

2. 통신 보안
   - HTTPS (증권사 API 기본)
   - 토큰 갱신 자동화

3. 로깅 (선택)
   - 거래 내역 기록 (본인 확인용)
   - 오류 추적

4. 백업 (선택)
   - 설정 파일 백업
   - 전략 코드 백업

⚠️ 주의:
→ 법적 의무는 아니지만
→ 금전적 손실 방지 위해 권장
```

---

## 📋 Layer 3 제약사항 종합

### L3-Q1: 기술 스택 제약

**외부 제약 (증권사별 차이)**:
```
✅ 한국투자증권 선택 시:
- REST API: 초당 20건 (실전), 2건 (모의)
- WebSocket: 1세션당 41건
- 인증: 토큰 기반 (Appkey + App secret)
- 프로토콜: REST + WebSocket
- OS: 크로스 플랫폼 (Linux/Docker 가능)

⚠️ 키움증권 선택 시:
- REST API: 초당 5건, 시간당 1000건
- 인증: 공인인증서
- 프로토콜: COM/DLL (Windows)
- OS: Windows 전용 (서버 제약)

⚠️ 설계 필수 고려:
- 요청 큐잉 시스템
- Throttling
- WebSocket 구독 관리
- 토큰/인증서 갱신 시스템
```

### L3-Q2: 팀 역량 (Part 1에서 가정)

**추가 학습 필요 항목**:
```
기술 스택:
✅ 필수 학습:
- 증권사 API 사용법
- WebSocket 실시간 통신
- Rate Limiting 처리

✅ 보안 (선택, 권장):
- API 키 보안 관리
- 환경 변수 설정
- Git 보안 (.gitignore)

❌ 학습 불필요 (개인 사용):
- 금융 규제 상세
- KYC 프로세스
- 개인정보보호법 상세
```

### L3-Q3: 배포 환경

**개인 사용 프로젝트**:
```
✅ 자유로운 선택:
- 클라우드 (AWS, Azure, GCP) 사용 가능
- 로컬 서버 (집 컴퓨터) 가능
- VPS 호스팅 가능
- Docker 컨테이너 가능

⚠️ 증권사별 제약:
- 한투/이베스트: 크로스 플랫폼 OK
- 키움/대신: Windows 필수

❌ 규제 제약 없음:
- 데이터 보관 의무 없음
- 국내 서버 의무 없음
- 금융보안원 인증 불필요
```

**권장 사항 (선택)**:
```
✅ 권장:
- 안정적인 인터넷 연결
- 24/7 실행 환경 (거래 시간 중)
- 백업 (설정, 전략 코드)

이유:
→ 법적 의무는 아니지만
→ 거래 기회 놓치지 않기 위해
```

---

## 🔥 아키텍처 결정에 미치는 영향

### 1. Rate Limiting이 설계의 핵심!

```
Layer 2 NFR: 정확성 A + 즉시성 A
↓
Layer 3 제약:
- 한투: API 초당 20건
- 키움: API 초당 5건 (4배 느림!)
↓
충돌 발생! ⚠️

증권사 선택이 아키텍처를 결정!
- 한투 선택 → 20건/초 → 더 많은 실시간 처리 가능
- 키움 선택 → 5건/초 → 더 보수적 설계 필요

해결 필요:
- "정확성 100% + 즉시성" 불가능?
- 증권사별 트레이드오프 다름
- ADR 작성 필수!
```

### 2. WebSocket 41건 제한

```
개인 사용 기준:
→ 관심 종목 41개까지 실시간 모니터링 가능
→ 대부분 충분함

⚠️ 만약 서비스화 시 (사용자 100명):
→ 1000개 구독 필요
→ WebSocket 41건 제한
→ 해결 방안 필요 (우선순위, 공유 등)
```

### 3. 규제 제약 = 거의 없음!

```
✅ 개인 사용의 자유:
- 데이터 보관 의무 없음
- 신고/인허가 불필요
- 기술 스택 자유 선택
- 배포 환경 자유 선택

⚠️ 유일한 제약:
- 증권사 API Rate Limit (20건/초 또는 5건/초)
- 증권사 선택에 따른 OS 제약 (Windows vs 크로스플랫폼)

→ 개인 사용은 매우 자유로움!
```

---

## 📝 다음 단계

### 1. Layer 3 통합 작성
- Part 1 (내부 결정) + Part 2 (외부 제약)
- 최종 Layer 3 답변 정리

### 2. 충돌 패턴 분석
```
충돌: 정확성 A + 즉시성 A vs API 초당 20건
→ ADR 작성
→ 트레이드오프 전략
```

### 3. 5단계 구현방법
- 제약사항 반영한 구현 전략
- 특히 2단계 "속성 질문"에 제약 반영

---

## 🎁 핵심 발견

### 1. 증권사 선택이 아키텍처를 결정!

```
Layer 3의 핵심:
→ 증권사 API 선택이 가장 중요한 제약!
→ Rate Limit, OS, 개발 환경 모두 결정됨
```

### 2. 외부 제약이 NFR 충돌 유발

```
Layer 2: 정확성 A + 즉시성 A
→ 이상적 목표

Layer 3: API 초당 20건 (한투) 또는 5건 (키움)
→ 현실적 제약

→ 트레이드오프 필수!
```

### 3. 개인 사용은 규제가 거의 없음!

```
✅ 개인 사용의 장점:
- 거래 기록 보관 의무 없음
- 개인정보보호법 미적용
- 신고/인허가 불필요
- 금융보안원 인증 불필요

⚠️ 유일한 의무:
- 증권사 API 약관 준수
- 본인 계좌만 사용
- API 키 보안

❌ 서비스화 시:
- 완전히 다른 차원의 규제 발생!
```

---

## 📚 참고 자료

### 조사 출처:

1. **증권사 API (6개)**
   - 한국투자증권: REST, 초당 20건
   - 키움증권: COM/DLL, 초당 5건
   - 이베스트투자증권: REST, 초당 10건
   - 대신증권: COM/DLL
   - NH투자증권: QV API (정보 제한적)
   - 삼성증권: 개인 사용 불가

2. **알고리즘 트레이딩 규제**
   - 5억원 미만: 규제 없음
   - 개인 사용: 신고/인허가 불필요

3. **개인정보보호법 (2024-2025)**
   - 개인 사용: 미적용
   - 타인 정보 처리 시: 준수 필요

---

**작성**: 2호 (Claude Code)
**조사 기간**: 2025-11-12
**상태**: Layer 3 Part 2 수정 완료 (개인 사용 기준)
**핵심**:
- 개인 사용 = 규제 거의 없음!
- 증권사 선택 = 아키텍처 결정!
- 서비스화 시 = 완전히 다른 규제!
