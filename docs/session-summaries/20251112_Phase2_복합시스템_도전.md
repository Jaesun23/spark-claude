# Phase 2: 복합 시스템 도전 - 주식 거래 플랫폼

**날짜**: 2025-11-12
**참여자**: Jason + 2호 (Claude Code)
**목적**: 3-Layer 프레임워크로 복합 시스템 분석 도전

---

## 🎯 현재 상황

### Phase 1 완료 ✅
- ✅ 이론적 매핑 완료 (ARCHITECTURE_THEORY_MAPPING.md)
- ✅ Layer 2 ↔ SEI Quality Attributes 검증
- ✅ Layer 1 ↔ Martin Fowler Patterns 검증
- ✅ 충돌 패턴 ↔ CAP/ACID/BASE 검증

### Phase 2 시작 🔄
- 목표: 실시간 스트리밍 패밀리 (패밀리 3) 사례 추가
- 선정: **주식 거래 플랫폼** (Jason이 나중에 실제 만들 시스템)

---

## 🔥 핵심 도전 과제 발견

### 복합 시스템의 복잡도

**시스템 구성**:
```
주식 거래 플랫폼 = 복합 시스템
├─ 1. 실시간 호가 스트리밍 (부가 기능)
│  └─ 역할: 최신 가격 정보 제공
│
└─ 2. 거래 (핵심 기능) 💥
   ├─ 구현 방식 A: 수동 거래
   │  └─ 사용자 클릭 → 거래 요청 → 체결
   └─ 구현 방식 B: 자동 거래
      ├─ 전략 1: 지정가 도달 시 매수
      ├─ 전략 2: % 변동 감지 시 매도
      └─ 전략 3: 정기 매수 (적립식)

   실패 영향: 거래 못 함 → 금전 손실 (A)
   → 구현 방식과 무관!
```

**핵심 인사이트**:
- **핵심 기능 = "거래" (하나!)**
- **수동/자동 = "구현 방식" (여러 개)**
- 거래 실패 = 금전 손실 (방식과 무관)

---

## 💡 Jason의 핵심 통찰

### "방법론의 본질"

```
❌ "복잡하니까 시스템을 쪼개자"
   → 구현 편의주의

✅ "3-Layer 질문이 이 복잡도를 해결하는가?"
   → 방법론 검증!
```

**Jason의 원칙**:
> "우리는 엔터프라이즈 기업의 소프트웨어 개발 방법을 연구하고 있어요.
> 복잡도를 떠나서 우리의 질문들이 어떻게 구성되어야
> 이 문제들을 해결할 시스템적 답안으로 이끌 것인가를 찾아야 한다는 거에요."

**검증 질문**:
```
현재 3-Layer 10개 질문으로
복합 시스템을 하나의 일관된 아키텍처로 이끌 수 있는가?

YES → 질문이 잘 설계됨 ✅
NO → 질문 수정/추가 필요 ⚠️
```

---

## 🎯 현재까지 분석 결과

### Layer 1: 아키텍처 패밀리 (핵심 기능 기준)

**판단 원칙**: "핵심 기능"의 **비즈니스 목적**으로 답변 (구현 방식 X)

**L1-Q1: 실패 파급력**
```
핵심 기능 = 거래 (Trading)
- 거래 요청 전달 실패 → 금전 손실
- 원하는 가격에 체결 못 함 → 금전 손실
- 수동/자동 무관, 모든 거래 실패가 치명적

선택: A (치명적) ✅
```

**L1-Q2: 정보 형태**
```
주가, 호가, 거래량 = 숫자 시계열
% 변동 계산, 이동평균
조건 비교 (지정가 도달 여부)

선택: C (숫자·분석 데이터) ✅
```

**L1-Q3: 응답 시점**
```
거래 요청 → 즉시 체결 필요
가격 변동 → 즉시 감지 필요
체결 완료 → 즉시 알림 필요

선택: A (즉각 응답) ✅
```

**→ 패밀리: A-C-A** 💥

**핵심 포인트**:
- ❌ "자동 거래"가 핵심 (구현 방식 기준)
- ✅ "거래 기능"이 핵심 (비즈니스 목적 기준)

### 🔥 중요 발견 1: 새로운 패밀리 패턴!

**기존 5개 패밀리**:
```
1. CRUD/트랜잭션 (A-A-A)
2. 검색/추천 (C-B-B)
3. 실시간 스트리밍 (B-C-A)
4. 협업/동기화 (B-A-A)
5. 분석/배치 (C-C-C)
```

**주식 거래 플랫폼**:
```
A-C-A ← 기존에 없던 조합!
```

**새 패밀리 후보**:
- **"실시간 트랜잭션"** 패밀리?
- 특성: 실패 치명적 + 숫자 데이터 + 즉각 응답
- 예시: 금융 거래, 자동화 시스템, IoT 제어

---

### Layer 2: NFR 우선순위

**L2-Q1: 핵심 품질**
```
A (가장 정확 - 100%) ✅
- 조건 감지 오류 = 금전 손실
- "70,000원 도달" 놓치면 안 됨
```

**L2-Q2: 규모**
```
B (B2C - 동시 1만 명) ✅
- 개인 투자자 플랫폼
```

**L2-Q3: 데이터 노출**
```
B (암호화 - 멀티 테넌트) ✅
- 개인 투자 내역 = 민감 정보
- 금융위원회 규제
```

**L2-Q4: 데이터 최신성**
```
A (즉시 반영 - 초 단위) ✅
- 호가 변동 즉시 반영
- 조건 감지 즉시 체결
```

**NFR 프로파일**: A-B-B-A

### 🔥 중요 발견 2: 충돌 패턴 예상

```
L2-Q1 (정확성 A: 100%) + L2-Q4 (즉시 A: 초 단위)
→ 100% 정확하게 + 즉시 감지/실행?
→ 가능한가? 트레이드오프 있나?
```

**예상 충돌**:
- 조건 감지의 정확성 vs 실시간 처리
- 모든 조건을 실시간으로 100% 정확히 감지 가능한가?

---

## 🤔 현재 질문 및 과제

### 질문 1: 패밀리 분류
- **A-C-A 패턴**을 어떻게 다룰 것인가?
  - 옵션 1: 6번째 패밀리 추가 ("실시간 트랜잭션")
  - 옵션 2: 기존 패밀리에 억지로 매핑
  - 옵션 3: 패밀리 수를 늘리는 게 맞는가?

### 질문 2: 복합 시스템 처리
- ✅ "핵심 기능" 판단 기준 명확화 완료
  - ❌ 구현 방식 (수동/자동)
  - ✅ 비즈니스 목적 (거래)
- 부가 기능(호가 스트리밍)은 어떻게 설계하나?
- Layer 1-2로 핵심 아키텍처 결정 → 부가 기능은 그 안에서 설계

### 질문 3: Layer 3 & 5단계
- Layer 3 (환경 제약) 적용 필요
- 5단계 구현방법 작성
- 충돌 패턴 해결 전략 도출

---

## 📝 다음 단계 (Context 복구 후)

### 1. Layer 3 완료 🔄 진행 중

**접근 방식**: 내부 결정 사항 먼저 → 외부 제약 조사

#### Part 1: 우리가 결정/가정 가능한 항목 ✅

**L3-Q2: 팀 역량 (가정)**
```
팀 구성:
- 백엔드: 1-2명 (Python/Node.js)
- 프론트엔드: 1명 (React/Next.js)
- 금융 도메인 경험: 없음 (학습 필요)

기술 역량:
✅ 일반 웹 개발: 가능
✅ REST API, WebSocket: 가능
❓ 금융 규제 이해: 학습 필요
❓ 보안 인증: 학습 필요
```

**기술 스택 (제약 내 선택 가능)**
```
백엔드:
- FastAPI (Python) 또는 NestJS (Node.js)

프론트엔드:
- Next.js + React

실시간 통신:
- WebSocket (증권사 API 지원 시)
- Server-Sent Events (대안)

데이터:
- Redis (실시간 호가 캐싱)
- PostgreSQL (거래 기록, 사용자)
- TimescaleDB (시계열 데이터)
```

#### Part 2: 외부 제약 조사 필요 ⏸️

**L3-Q1: 기술 스택 제약 (조사 필요)**
```
□ 증권사 API 프로토콜
  - REST? WebSocket? FIX Protocol?
  - 인증 방식 (OAuth? API Key?)

□ 호출 제한
  - Rate Limiting
  - 비용 구조

□ 실시간 데이터
  - 호가 업데이트 주기
  - 자동 거래 허용 범위
```

**L3-Q3: 배포 환경 (조사 필요)**
```
□ 금융 규제
  - 전자금융거래법 요구사항
  - 자본시장법 (투자자 보호)

□ 데이터 보관
  - 개인정보보호법
  - 국내 보관 의무?
  - 거래 기록 보관 기간

□ 보안 인증
  - 금융보안원 인증 필요?
  - 전자서명 의무
  - 2차 인증 (2FA)
```

**조사 대상 증권사**:
```
1. 한국투자증권 API
2. 키움증권 API
3. 삼성증권 API

비교 항목:
- 프로토콜 및 인증
- Rate Limiting
- 실시간 데이터 제공 방식
- 테스트 환경
- 비용
```

### 2. 5단계 구현방법 작성
```
1단계: 기능 분해
  - 호가 스트리밍
  - 수동 거래
  - 자동 거래 (3가지 전략)

2단계: 속성 질문 ⭐
  - "조건 감지 정확도는?"
  - "호가 업데이트 지연은?"
  - "체결 응답 시간은?"

3단계: 제약조건
  - 거래소 API 호출 비용
  - 금융위원회 규제

4단계: 기술 옵션 탐색
  - WebSocket vs gRPC
  - Redis vs Kafka
  - 조건 감지 엔진?

5단계: 통합 설계
  - 전체 아키텍처
  - 데이터 흐름
```

### 3. 충돌 패턴 분석
```
충돌: 정확성 (A) + 즉시성 (A)
해결 전략: ???
ADR 작성: ???
```

### 4. Martin Fowler Patterns 매핑
```
A-C-A 패턴 → 어떤 Fowler Pattern?
- 실시간: Gateway (WebSocket)?
- 조건 감지: ???
- 자동 실행: Transaction Script?
```

---

## 🎁 핵심 교훈

### 1. 방법론 검증의 본질
```
❌ "사례를 방법론에 끼워 맞추기"
✅ "방법론이 사례를 해결하는지 검증"
```

### 2. 복잡도는 회피 대상이 아님
```
복잡한 시스템 = 방법론의 진짜 시험대
→ 여기서 막히면 질문 구조 개선 필요
→ 이게 진짜 "이론 검증"
```

### 3. 새로운 패턴 발견 = 성공
```
A-C-A 패턴 발견
→ 기존 5개 패밀리로 부족할 수 있음
→ 방법론 확장의 기회
```

---

## 📊 현재 검증 상태

| 항목 | 상태 | 비고 |
|------|------|------|
| Phase 1: 이론 매핑 | ✅ 완료 | SEI, Fowler, CAP 검증 완료 |
| 사례 1: 문서 생성 | ✅ 완료 | 패밀리 1 (A-A-A) |
| 사례 2: AI 메모리 | ✅ 완료 | 패밀리 2 (C-B-B), 충돌 해결 |
| 사례 3: 채팅 앱 | ✅ 완료 | 패밀리 3 (B-C-A) |
| **사례 4: 주식 거래** | 🔄 진행 중 | **패밀리 A-C-A** (새 패턴!) |
| Layer 1-2 완료 | ✅ | Layer 3, 5단계 남음 |
| 충돌 패턴 분석 | ⏸️ 대기 | 정확성+즉시성 충돌 예상 |

---

## 🚀 현재 작업 진행 상황

### ✅ 완료된 작업
1. **핵심 기능 구분 명확화**
   - ❌ 수동/자동 = 2개 기능 → ✅ 거래 = 1개 기능
   - 문서: `20251112_핵심기능_판단기준.md`

2. **Layer 1-2 분석 완료**
   - Layer 1: A-C-A (새 패밀리 패턴!)
   - Layer 2: A-B-B-A

3. **Layer 3 Part 1 완료**
   - 내부 결정 사항 정리 (팀 역량, 기술 스택)

### 🔄 진행 중
4. **Layer 3 Part 2 - 외부 제약 조사**
   - 금융 규제
   - 증권사 API 조건
   - 보안/인증 요구사항

### ⏸️ 대기 중
5. **5단계 구현방법** 작성 (특히 2단계 속성 질문!)
6. **충돌 패턴** 분석 및 해결
7. **ADR 템플릿** 2-3개 작성
8. **02-1_IMPLEMENTATION_CASES.md**에 사례 4 추가
9. **A-C-A 패밀리** 이론적 검증 (Fowler Pattern 매핑)

---

**작성**: 2호 (Claude Code)
**검토**: Jason
**상태**: Layer 3 외부 제약 조사 시작
**핵심**: 금융 거래 시스템 = 규제와 제약이 아키텍처를 결정!
