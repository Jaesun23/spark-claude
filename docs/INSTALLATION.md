# SPARK v3.5 Installation Guide

Complete installation guide for SPARK's multi-agent orchestration system with lazy-loading architecture and integrated FileLockManager.

## Quick Start

### Basic Global Installation
```bash
# Clone repository
git clone https://github.com/Jaesun23/spark-claude.git
cd spark-claude

# Run installation script
./scripts/install.sh

# Restart Claude Code
```

This enables SPARK across all your projects.

---

## Installation Options

### 1. Global Installation (~/.claude/)
**Best for individual developers**

**Advantages:**
- SPARK available in all projects
- One-time installation and updates
- Centralized configuration

**Disadvantages:**
- Limited per-project customization
- Potential command conflicts (solved with namespaces)

**Selection:**
```
=== Installation Location ===
1) Global installation (~/.claude/)  ← Choose this
```

### 2. Project-Specific Installation
**Best for team projects**

**Advantages:**
- Independent project settings
- Version control friendly (Git shareable)
- Easy team collaboration

**Disadvantages:**
- Installation needed per project
- Duplicate storage usage

**Selection:**
```
=== Installation Location ===
2) Project-specific installation (project/.claude/)  ← Choose this
Project directory path: /Users/jason/my-project
```

### 3. Current Directory Installation (./.claude/)
**For SPARK development only**

**Use cases:**
- SPARK development and testing
- Temporary installations
- Overwriting existing configurations

---

## Components

### Available Components

**1. SPARK Agents (28 total)**
- 16 base agents (core functionality)
- 12 team agents (parallel execution: team1-4 × implementer/tester/documenter)
- Lazy-loading architecture saves ~39K tokens
- Essential component

**2. Single Agent Commands**
- `/spark-implement`, `/spark-test`, `/spark-analyze`, etc.
- Direct shortcuts to individual agents
- Namespace support prevents conflicts (e.g., `/myproject:implement`)

**3. Multi-Agent Pipelines**
- `/spark-launch` - 5-agent sequential pipeline
- `/spark-optimize` - Performance optimization workflow
- **Automatically includes hooks and workflows**

**4. Hook Scripts (5 essential hooks)**
- `spark_persona_router.py` - Agent selection logic
- `spark_phase_manager.py` - 5-Phase execution management
- `spark_quality_gates.py` - 8-step quality validation protocol
- `spark_core_utils.py` - Shared utilities and state management
- `file_lock_manager.py` - Thread-safe parallel execution

**5. Workflow Management**
- Task state tracking via JSON files
- Inter-agent context sharing
- Team coordination templates

### Selection Example
```
=== Installation Components ===

1) SPARK agents (28 total) install? (Y/n): y
✓ Agents installation planned

2) Single agent commands install? (Y/n): y  
✓ Commands installation planned

3) Multi-agent pipelines install? (requires hooks) (Y/n): y
✓ Multi-agent pipelines installation planned
✓ Hooks and workflows automatically included
```

---

## Post-Installation

### 1. Restart Claude Code
**Required** - Claude Code must be restarted for new settings to load.

### 2. Verify Installation
```bash
# Check agents (should be 28 files)
ls ~/.claude/agents/ | wc -l

# Check commands  
ls ~/.claude/commands/spark-*.json

# Check settings
cat ~/.claude/settings.json

# Check hooks (should be 5 files)
ls ~/.claude/hooks/spark_*.py ~/.claude/hooks/file_lock_manager.py
```

### 3. First Use Examples
```bash
# Single agent
/spark-implement "create JWT authentication"

# Multi-agent pipeline
/spark-launch "new dashboard feature with real-time updates"

# Team parallel execution
/multi-implement "API endpoints" "UI components" "Database schema" "Documentation"
```

---

## Troubleshooting

### 1. Command Conflicts
**Problem:** "Command already exists" error

**Solution:** Use namespaces during installation
```bash
./scripts/install.sh
# After selecting installation location:
Use namespace? (e.g., /spark:implement) (Y/n): y
Namespace prefix (default: spark): myproject
```

Commands become `/myproject:implement`, `/myproject:test`, etc.

### 2. Missing JSON Files
**Problem:** Agents report "cannot find current_task.json"

**Solution:** v3.5 automatically checks fallback paths:
1. `~/.claude/workflows/` (global)
2. `.claude/workflows/` (project)

Manual initialization if needed:
```bash
mkdir -p ~/.claude/workflows
echo '{}' > ~/.claude/workflows/current_task.json
echo '{}' > ~/.claude/workflows/unified_context.json

# Team templates (auto-generated by hooks)
echo '{"team_id": "team1", "status": "ready"}' > ~/.claude/workflows/team1_task.json
echo '{"team_id": "team2", "status": "ready"}' > ~/.claude/workflows/team2_task.json
echo '{"team_id": "team3", "status": "ready"}' > ~/.claude/workflows/team3_task.json
echo '{"team_id": "team4", "status": "ready"}' > ~/.claude/workflows/team4_task.json
```

### 3. Hooks Not Executing
**Problem:** Multi-agent pipelines not working

**Check:**
```bash
# Verify hooks in settings.json
cat ~/.claude/settings.json | grep -A10 hooks

# Check file permissions
ls -la ~/.claude/hooks/*.py

# Grant execution permissions
chmod +x ~/.claude/hooks/*.py

# Verify all 5 hook files exist
ls ~/.claude/hooks/spark_*.py ~/.claude/hooks/file_lock_manager.py
```

### 4. FileLockManager Issues
**Problem:** Team parallel execution conflicts

**Solution:** FileLockManager is integrated into StateManager. Check integration:
```bash
# Verify FileLockManager integration
grep -n "FileLockManager" ~/.claude/hooks/spark_core_utils.py
```

### 5. Symbolic Link Handling
**Problem:** ~/.claude is a symbolic link

**Solution:** Installation script automatically handles this. Verify:
```bash
# Check if ~/.claude is symbolic link
ls -la ~/.claude

# Check actual path
readlink ~/.claude
```

---

## Uninstallation

### Remove Global Installation
```bash
# Backup first (optional)
cp -r ~/.claude ~/.claude.backup

# Remove only SPARK components
rm -rf ~/.claude/agents/*-spark.md
rm -rf ~/.claude/commands/spark-*.json  
rm -rf ~/.claude/hooks/spark_*.py ~/.claude/hooks/file_lock_manager.py
rm -rf ~/.claude/workflows/team*_task.json

# Or complete removal
rm -rf ~/.claude
```

### Remove Project-Specific Installation  
```bash
cd /your/project
rm -rf .claude
```

---

## Installation Comparison

| Feature | Global Installation | Project-Specific |
|---------|-------------------|-----------------|
| **Location** | ~/.claude/ | project/.claude/ |
| **Scope** | All projects | Single project |
| **Hooks** | $HOME/.claude/hooks/ | $PROJECT/.claude/hooks/ |
| **Workflows** | ~/.claude/workflows/ | project/.claude/workflows/ |
| **Updates** | Once only | Per project |
| **Team Sharing** | Manual setup | Git shareable |
| **Conflicts** | Possible (namespace fixes) | None |

---

## Recommended Configurations

### Individual Developer
- **Global installation** + **All components**
- Maximum convenience across all projects

### Team Project  
- **Project-specific installation** + **Selective components**
- Easy sharing via version control
- Per-project customization

### SPARK Development
- **Current project installation**
- Testing and development workflow

---

## Key SPARK v3.5 Features

- **Lazy-loading agents**: Only loads required agents (saves ~39K tokens)
- **FileLockManager integration**: Thread-safe parallel execution  
- **5-hook system**: Streamlined from previous 10 hooks
- **Team JSON templates**: Auto-generation for parallel coordination
- **Token Safety Protocol**: 90K limit with pre-task assessment
- **28 specialized agents**: 16 base + 12 team agents for parallel work

---

For additional help, see [AGENTS.md](./AGENTS.md) and [DEVELOPMENT.md](./DEVELOPMENT.md).