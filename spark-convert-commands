#!/usr/bin/env python3
"""
SPARK ëª…ë ¹ì–´ ë¬¸ì„œë¥¼ TXTë¡œ ë³€í™˜í•˜ê³  í†µí•©í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸
"""

import os
import sys
from pathlib import Path

def convert_commands_to_txt():
    """
    commands ë””ë ‰í† ë¦¬ì˜ ëª¨ë“  .md íŒŒì¼ì„ .txtë¡œ ë³€í™˜í•˜ê³  í†µí•©
    """
    # ê²½ë¡œ ì„¤ì •
    commands_dir = Path("/Users/jason/Projects/spark-claude/.claude/commands")
    output_dir = commands_dir.parent / "commands_txt"
    
    if not commands_dir.exists():
        print(f"âŒ commands ë””ë ‰í† ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {commands_dir}")
        return False
    
    # ì¶œë ¥ ë””ë ‰í† ë¦¬ ìƒì„±
    output_dir.mkdir(exist_ok=True)
    
    # .md íŒŒì¼ ì°¾ê¸°
    md_files = list(commands_dir.glob("*.md"))
    
    if not md_files:
        print(f"âš ï¸ {commands_dir}ì— .md íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.")
        return False
    
    print("ğŸš€ SPARK ëª…ë ¹ì–´ MD â†’ TXT ë³€í™˜")
    print("=" * 50)
    print(f"ğŸ“ ì¶œë ¥ ë””ë ‰í† ë¦¬: {output_dir}")
    print(f"ğŸ“ {len(md_files)}ê°œì˜ ëª…ë ¹ì–´ íŒŒì¼ì„ ë³€í™˜í•©ë‹ˆë‹¤...\n")
    
    converted_count = 0
    
    # ê°œë³„ íŒŒì¼ ë³€í™˜
    for md_file in md_files:
        try:
            txt_filename = md_file.stem + ".txt"
            txt_path = output_dir / txt_filename
            
            with open(md_file, 'r', encoding='utf-8') as f:
                content = f.read()
            
            with open(txt_path, 'w', encoding='utf-8') as f:
                f.write(content)
            
            print(f"âœ… {md_file.name} â†’ {txt_filename}")
            converted_count += 1
            
        except Exception as e:
            print(f"âŒ {md_file.name} ë³€í™˜ ì‹¤íŒ¨: {e}")
    
    print(f"\nğŸ‰ ê°œë³„ ë³€í™˜ ì™„ë£Œ! {converted_count}/{len(md_files)} íŒŒì¼ì´ ë³€í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.")
    
    # í†µí•© íŒŒì¼ ìƒì„±
    print("\nğŸ“š í†µí•© íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤...")
    
    combined_path = output_dir / "all_commands_combined.txt"
    with open(combined_path, 'w', encoding='utf-8') as combined:
        combined.write("=" * 80 + "\n")
        combined.write("SPARK v3.5 - ëª¨ë“  ëª…ë ¹ì–´ ì •ì˜ í†µí•© íŒŒì¼\n")
        combined.write("=" * 80 + "\n")
        combined.write("\nëª©ì°¨:\n")
        combined.write("-" * 40 + "\n")
        
        # ëª©ì°¨ ìƒì„±
        for md_file in sorted(md_files):
            combined.write(f"â€¢ {md_file.stem}\n")
        
        combined.write("\n" + "=" * 80 + "\n\n")
        
        # ê° íŒŒì¼ ë‚´ìš© ì¶”ê°€
        for md_file in sorted(md_files):
            with open(md_file, 'r', encoding='utf-8') as f:
                content = f.read()
            
            combined.write(f"\n{'='*80}\n")
            combined.write(f"ëª…ë ¹ì–´: {md_file.stem}\n")
            combined.write(f"íŒŒì¼: {md_file.name}\n")
            combined.write(f"{'='*80}\n\n")
            combined.write(content)
            combined.write("\n\n")
    
    print(f"âœ… í†µí•© íŒŒì¼ ìƒì„±: {combined_path}")
    
    # ì „ì²´ í†µí•© íŒŒì¼ ìƒì„± (agents + commands)
    print("\nğŸ¯ ì „ì²´ í†µí•© íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤ (agents + commands)...")
    
    agents_txt_dir = Path("/Users/jason/Projects/spark-claude/.claude/agents_txt")
    full_combined_path = Path("/Users/jason/Projects/spark-claude/.claude") / "spark_full_documentation.txt"
    
    with open(full_combined_path, 'w', encoding='utf-8') as full:
        full.write("=" * 80 + "\n")
        full.write("SPARK v3.5 - ì™„ì „í•œ ì‹œìŠ¤í…œ ë¬¸ì„œ\n")
        full.write("(ì—ì´ì „íŠ¸ + ëª…ë ¹ì–´ í†µí•©)\n")
        full.write("=" * 80 + "\n\n")
        
        # Part 1: Commands
        full.write("\n" + "=" * 80 + "\n")
        full.write("PART 1: SPARK ëª…ë ¹ì–´ ì‹œìŠ¤í…œ\n")
        full.write("=" * 80 + "\n\n")
        
        if combined_path.exists():
            with open(combined_path, 'r', encoding='utf-8') as f:
                full.write(f.read())
        
        # Part 2: Agents
        full.write("\n\n" + "=" * 80 + "\n")
        full.write("PART 2: SPARK ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ\n")
        full.write("=" * 80 + "\n\n")
        
        agents_combined = agents_txt_dir / "all_agents_combined.txt"
        if agents_combined.exists():
            with open(agents_combined, 'r', encoding='utf-8') as f:
                full.write(f.read())
        else:
            full.write("âš ï¸ ì—ì´ì „íŠ¸ í†µí•© íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n")
            full.write("'spark-convert-agents' ëª…ë ¹ì„ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”.\n")
    
    print(f"âœ… ì „ì²´ í†µí•© íŒŒì¼ ìƒì„±: {full_combined_path}")
    
    # ìš”ì•½ ì •ë³´ ì¶œë ¥
    print("\n" + "=" * 50)
    print("ğŸ“Š ë³€í™˜ ê²°ê³¼ ìš”ì•½:")
    print(f"  â€¢ ëª…ë ¹ì–´ íŒŒì¼: {converted_count}ê°œ")
    print(f"  â€¢ ê°œë³„ TXT: {output_dir}/*.txt")
    print(f"  â€¢ ëª…ë ¹ì–´ í†µí•©: {combined_path}")
    print(f"  â€¢ ì „ì²´ í†µí•©: {full_combined_path}")
    
    return True

if __name__ == "__main__":
    success = convert_commands_to_txt()
    sys.exit(0 if success else 1)